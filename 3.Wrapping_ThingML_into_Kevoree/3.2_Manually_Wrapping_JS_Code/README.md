### How to use generated public APIs to integrate with ThingML at the code level (in JavaScript)?

Imagine you have this configuration:

```
configuration Deployment0JS {
    instance timer : TimerJS
}
```

Now if you generate the JS code and run the main, it won't do much: no one is calling the `timer_start` and no one is listening for the `timer_timeout` message.

We have seen in Tutorial 1 how Java (or JS, or C) code can be mixed with ThingML models. We will now see how we can integrate legacy/third-party code with ThingML,
directly at the code level using the public APIs generated by ThingML.

The generated code has the following structure:

```
Connector.js      #Utilities for ThingML connectors
main.js           #the file to run, instantiating things and connectors
package.json      #defines dependencies, etc needed for npm install
state-factory     #Utilities for instantiating the state machine, etc
TimerJS.js        #the generated code for the timer
```

Looking in more details at `main.js`:

```javascript
var Connector = require('./Connector');
var TimerJS = require('./TimerJS');
process.stdin.resume();//to keep Node.js alive even when it is nothing more to do...

var Deployment0JS_timer = new TimerJS();
Deployment0JS_timer.setThis(Deployment0JS_timer);

Deployment0JS_timer._init();

//terminate all things on SIGINT (e.g. CTRL+C)
process.on('SIGINT', function() {
console.log("Stopping components... CTRL+D to force shutdown");
Deployment0JS_timer._stop();
});
```

> The generated JS code has a fairly similar structure than the generated Java code.



Again, this main is pretty useless as it only instantiate a timer that no one uses.

However, you can register a listener on the timer (after it has been instantiated, and ideally before it has beem started)
so that you can get notified when the timer emits a timeout:

```javascript
Deployment0JS_timer.getTimerListeners().push(function(msg){console.log(msg);});
```

> Note that we directly instantiate the interface defined in the API package and provide its implementation (anonymous classe).
You can of course define your own class that implements this interface.

Well... listening to the timeout will not really help, until you call the timer_start (after the thing instance has been started):

```javascript
Deployment0JS_timer.receivetimer_startOntimer(2000);
```

After two seconds, you should see a timeout message in the console.


> The ThingML to Kevoree/JavaScript transformation is not yet implemented. But you can look at Deployment 1, 2 and 3 to see
the code we plan to generate, and execute this code using the Kevoree/JS runtime.

> Actually, an initial proof-of-concept has just been implemented. Please try it and report on bugs, etc. **Always generate the "normal" JavaScript code before generating the Kevoree/JS code**. Indeed, the ThingML-to-Kevoree transformation will modify some of the pre-generated files, such as the `package.json` to add the proper dependencies, etc. To generate the Kevoree code: `right click on ThingML file -> ThingML (Deprecated) -> Compile JS Kevoree`. (Note that the transformation in itself is not deprecated, only the way it is currently integrated is).
